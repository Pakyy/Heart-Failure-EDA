---
title: "Data Visualization Exam"
author: "Pasquale Gravante & Antonio Mastroianni"
date: "2022-10-24"
output: html_document
---

The dataset consists of data regarding **299 patients** possibly affected by cardiovascular deseases.
The variables taken into account for the analysis are:
* **Age**
* **Sex**
* 
* **Anaemia**: decrease of red blood cells or haemoglobin **(Boolean)**
* **Creatinine_phosphokinase**: level of the CPK enzyme in the blood **(mcg/L)**
* **Diabetes**: whether the patient has diabetes **(Bolean)**
* **Ejection_fraction**: Percentage of blood leaving the heart at each contraction
* **high_blood_pressure**: whether the patient suffers from hypertension
* **Platelets**: Platelets in the blood **(kiloplatelets/mL)*
* **serum_creatinine**: Level of serum creatinine in the blood **(mg/dL)**
* **serum_sodium**: Level of serum sodium in the blood **(mEq/L)**
* **Smoking**: If the patient smokes or not **(Boolean)**
* **Time**: Follow-up period **(days)**

```{r Library}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(tidyr)
library(gridExtra)
```

```{r}
glimpse(heart)
```

```{r Editing column type}
for (i in c(2,4,6,11,13)){
  heart[,i] = as.factor(heart[,i])
}
heart$sex[heart$sex==0] <- 'Female'
heart$sex[heart$sex==1] <- 'Male'
heart$sex = as.factor(heart$sex)
glimpse(heart)
```

```{r}
data.frame(unclass(summary(heart[,-c(2,4,6,10,11,13)])), check.names = FALSE, stringsAsFactors = FALSE)
```

```{r Age histogram}
ggplot(heart, aes(x = age)) +
  geom_histogram(aes(y = ..density..), binwidth = 10, fill = 'cyan3', color = 'white') +
  theme_minimal() + 
  geom_vline(xintercept = mean(heart$age), color = 'deeppink2') +
  labs(x = 'Age', y='Density')+
  scale_x_continuous(breaks= c(35, 45,55,65,75,85,95))
```

```{r}
ggplot(heart, aes(x = creatinine_phosphokinase)) +
  geom_histogram(aes(y = ..density..), binwidth = 100, fill = 'cyan3', color = 'white') +
  theme_minimal() + 
  geom_vline(xintercept = mean(heart$creatinine_phosphokinase), color = 'deeppink2') +
  geom_vline(xintercept = median(heart$creatinine_phosphokinase), color = 'purple') +
  labs(x = 'CPK', y='Density')
```
```{r Variability measures}
var <- c(var(filter(heart, sex == 'Male')$creatinine_phosphokinase),
var(filter(heart, sex == 'Female')$creatinine_phosphokinase))

sd <- c(sd(filter(heart, sex == 'Male')$creatinine_phosphokinase),
sd(filter(heart, sex == 'Female')$creatinine_phosphokinase))

diff <- c(diff(range(filter(heart, sex == 'Male')$creatinine_phosphokinase)),
diff(range(filter(heart, sex == 'Female')$creatinine_phosphokinase)))

interquartile_range <- function(x){
diff(quantile(x, probs = c(0.25, 0.75)))
}

iq <- c(interquartile_range(filter(heart, sex == 'Male')$creatinine_phosphokinase),
interquartile_range(filter(heart, sex == 'Female')$creatinine_phosphokinase))

MAD <- function(x) {
median(abs(x - median(x)))
}

mad <- c(MAD(filter(heart, sex == 'Male')$creatinine_phosphokinase),
MAD(filter(heart, sex == 'Female')$creatinine_phosphokinase))

data.frame(sex, var, sd, diff, iq, mad)

```

```{r Boxplots in base al sesso}
options(scipen = 999)
bp1 = ggplot(heart, aes(x = sex, y = serum_creatinine, fill = sex)) + geom_boxplot() 
bp2 = ggplot(heart, aes(x = sex, y = creatinine_phosphokinase, fill = sex)) + geom_boxplot() 
bp3 = ggplot(heart, aes(x = sex, y = platelets, fill = sex)) + geom_boxplot() 
bp4 = ggplot(heart, aes(x = sex, y = ejection_fraction, fill = sex)) + geom_boxplot() 
grid.arrange(bp1,bp2,bp3,bp4, nrow = 2)
```

```{r Boxplots fumatori}
bp5 = ggplot(heart, aes(x = smoking, y = serum_creatinine, fill = smoking)) + geom_boxplot() 
bp6 = ggplot(heart, aes(x = smoking, y = creatinine_phosphokinase, fill = smoking)) + geom_boxplot() 
bp7 = ggplot(heart, aes(x = smoking, y = platelets, fill = smoking)) + geom_boxplot() 
bp8 = ggplot(heart, aes(x = smoking, y = ejection_fraction, fill = smoking)) + geom_boxplot() 
grid.arrange(bp5,bp6,bp7,bp8, nrow = 2)
```

```{r Boxplots diabetici}
bp9 = ggplot(heart, aes(x = diabetes, y = serum_creatinine, fill = diabetes)) + geom_boxplot() 
bp10 = ggplot(heart, aes(x = diabetes, y = creatinine_phosphokinase, fill = diabetes)) + geom_boxplot() 
bp11 = ggplot(heart, aes(x = diabetes, y = platelets, fill = diabetes)) + geom_boxplot() 
bp12 = ggplot(heart, aes(x = diabetes, y = ejection_fraction, fill = diabetes)) + geom_boxplot()
grid.arrange(bp9,bp10,bp11,bp12, nrow = 2)
```
